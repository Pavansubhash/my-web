<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazon Seller Partner Auth</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
        }
        .status {
            margin-top: 20px;
            font-size: 1.2em;
            color: green;
        }
    </style>
</head>
<body>

    <h1>Amazon Seller Partner Authentication</h1>
    <button id="authorizeButton">Connect</button>
    <div class="status" id="status"></div>

    <script>
        const clientId = 'amzn1.sp.solution.6a042822-89eb-4614-bf6d-6fc30db09e4b'; // Replace with your client ID
        const redirectUri = 'https://flash-verb.auperator.co/installed-app-list/app-detail/2373'; // Replace with your redirect URI
        const state = 'https://flash-verb.auperator.co/installed-app-list/app-detail/2373'; // Replace with a unique state value

        document.getElementById('authorizeButton').addEventListener('click', function () {
            // Construct the OAuth authorization URL
            const authUrl = `https://sellercentral.amazon.com/apps/authorize/consent?application_id=${clientId}&state=${state}&version=beta`;
            window.location.href = authUrl; // Redirect to Amazon's sign-in page
        });

        // Check if the page was loaded with query parameters
        const params = new URLSearchParams(window.location.search);
        if (params.has('spapi_oauth_code') && params.has('state') && params.has('selling_partner_id')) {
            const spAuthCode = params.get('spapi_oauth_code');
            const sellerPartnerId = params.get('selling_partner_id');

            // Display success status
            document.getElementById('status').innerHTML = 'Connection successful!<br>' +
                `Authorization Code: ${spAuthCode}<br>` +
                `Seller Partner ID: ${sellerPartnerId}`;

            // Optional: Redirect to the original URI stored in 'state'
            const originalUri = params.get('state'); // Get the original URI from state
            if (originalUri) {
                // Redirect to the original URI with the authorization details
                window.location.href = `${originalUri}?sp_auth_code=${spAuthCode}&selling_partner_id=${sellerPartnerId}`;
            }
        } else if (params.has('error')) {
            // Handle errors if the authorization failed
            document.getElementById('status').innerHTML = 'Connection unsuccessful: ' + params.get('error');
        }
    </script>

</body>
</html>
